var me=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var se=(s,d,i)=>d in s?me(s,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[d]=i,J=(s,d)=>{for(var i in d||(d={}))ve.call(d,i)&&se(s,i,d[i]);if(oe)for(var i of oe(d))he.call(d,i)&&se(s,i,d[i]);return s},Y=(s,d)=>fe(s,ge(d));var le=(s,d,i)=>new Promise((q,x)=>{var b=r=>{try{v(i.next(r))}catch(y){x(y)}},c=r=>{try{v(i.throw(r))}catch(y){x(y)}},v=r=>r.done?q(r.value):Promise.resolve(r.value).then(b,c);v((i=i.apply(s,d)).next())});import{d as F,j as $,J as X,r as o,o as _,D as T,w as t,b as e,e as h,c as C,n as f,u as a,h as Q,bg as ie,O as _e,$ as Z,a1 as G,a6 as te,F as V,q as ae,aw as de,t as B,s as be,x as ye,l as qe,d4 as L,aS as W,d3 as re,aT as M,ae as xe,L as we,aP as ce,ac as K,ba as Pe,cC as De,aN as Ie,bt as Ce,bu as Se}from"./index-3efa3bcd.js";import{i as ee}from"./icon-f6cbc454.js";/* empty css                                                                      */import{S as H}from"./SettingItemBox-94318b9b.js";import{r as ke}from"./chartEditStore-1e6a587f.js";import{n as Re}from"./noData-e5cefb25.js";import{u as ne}from"./useTargetData.hook-4df2987a.js";import{g as pe}from"./plugin-52ae8d1b.js";import"./index-9ba8d76c.js";import{R as $e,a as Oe}from"./pondIndex.vue_vue_type_style_index_0_scoped_639b4b2b_lang-1dd3716c.js";import"./EditorWorker-1ca10225.js";import"./editorWorker-02e2e6ec.js";import"./chartLayoutStore-db3d2e1b.js";import{l as Ee}from"./index-a77faccb.js";import{u as Te}from"./useSync.hook-e4169a36.js";import{S as A}from"./SettingItem-aacbe70b.js";import{C as He}from"./index-b6a655f0.js";import"./index-243612e8.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-bd202dab.js";import"./index.esm.min-21e18cb2.js";import"./fileTypeEnum-21359a08.js";import"./project.api-31a95c84.js";const Ue={class:"go-pr-3"},Ne={key:1},ze=F({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(s,{emit:d}){const i=s,{dataSyncUpdate:q}=Te();$();const x=$(),b=$(!1);X(()=>i.modelShow,r=>{b.value=r});const c=()=>{d("update:modelShow",!1)},v=()=>{var r,y;if(!((r=i.targetDataRequest)!=null&&r.dataPondName)){window.$message.warning("请在左下角输入名称！"),(y=x.value)==null||y.focus();return}pe({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{d("update:modelShow",!1),d("editSaveHandle",i.targetDataRequest),q()}})};return(r,y)=>{const w=o("n-space"),p=o("n-scrollbar"),P=o("n-tag"),D=o("n-input"),I=o("n-button"),O=o("n-card"),E=o("n-modal");return _(),T(E,{class:"go-chart-data-request",show:b.value,"onUpdate:show":y[1]||(y[1]=g=>b.value=g),"mask-closable":!1,closeOnEsc:!1},{default:t(()=>[e(O,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(w,{justify:"space-between"},{default:t(()=>[s.targetDataRequest?(_(),T(w,{key:0},{default:t(()=>[e(P,{bordered:!1,type:"primary"},{default:t(()=>[h("名称：")]),_:1}),e(D,{value:s.targetDataRequest.dataPondName,"onUpdate:value":y[0]||(y[0]=g=>s.targetDataRequest.dataPondName=g),ref_key:"inputInstRef",ref:x,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(_(),C("span",Ne)),e(w,null,{default:t(()=>[e(I,{onClick:c},{default:t(()=>[h("取消")]),_:1}),e(I,{type:"primary",onClick:v},{default:t(()=>[h("保存")]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(p,{style:{"max-height":"718px"}},{default:t(()=>[f("div",Ue,[e(w,{vertical:""},{default:t(()=>{var g;return[e(a($e)),e(a(Oe),{"target-data-request":(g=s.targetDataRequest)==null?void 0:g.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Le=Q(ze,[["__scopeId","data-v-639b4b2b"]]),Be=s=>(be("data-v-57909643"),s=s(),ye(),s),je={class:"go-chart-data-pond-list"},Ae={class:"pond-item-box"},Fe=Be(()=>f("span",null," 创建 ",-1)),Me=["onClick"],Ge={class:"item-content"},Qe={class:"item-content-body"},Ve=["onClick"],Je=F({__name:"index",emits:["createPond","deletePond"],setup(s,{emit:d}){ie(D=>({e1c1f336:y.value}));const{DuplicateOutlineIcon:i,TrashIcon:q}=ee.ionicons5,x=_e(),{chartEditStore:b,targetData:c}=ne(),{requestDataPond:v}=Z(b.getRequestGlobalConfig),r=G(()=>c.value.request.requestDataPondId),y=G(()=>x.getAppTheme),w=()=>{d("createPond",!0)},p=(D,I)=>{D.stopPropagation(),D.preventDefault(),d("deletePond",I)},P=D=>{c.value.request.requestDataPondId=D.dataPondId};return(D,I)=>{const O=o("n-timeline-item"),E=o("n-timeline"),g=o("n-icon"),N=o("n-button"),U=o("n-divider"),n=o("n-a"),l=o("n-text"),m=o("n-space"),k=o("n-tag"),S=o("n-ellipsis"),z=o("n-scrollbar");return _(),C("div",je,[e(E,{class:"pond-item-timeline",style:{width:"20px"}},{default:t(()=>[e(O,{type:"info"}),e(O,{type:"success"})]),_:1}),f("div",Ae,[e(N,{class:"create-btn go-py-4",ghost:"",onClick:w},{icon:t(()=>[e(g,null,{default:t(()=>[e(a(i))]),_:1})]),default:t(()=>[Fe]),_:1}),e(U,{style:{margin:"10px 0"}}),a(v).length?te("",!0):(_(),T(m,{key:0,justify:"center"},{default:t(()=>[e(l,{class:"not-layer-text",depth:3},{default:t(()=>[h(" 暂无数据内容， "),e(n,{onClick:w},{default:t(()=>[h("立即创建")]),_:1})]),_:1})]),_:1})),e(z,{style:{"max-height":"490px"}},{default:t(()=>[(_(!0),C(V,null,ae(a(v),u=>(_(),C("div",{key:u.dataPondId,class:de([{select:u.dataPondId===r.value},"pond-item"]),onClick:j=>P(u)},[f("div",Ge,[f("div",Qe,[f("div",null,[e(k,{class:"go-mr-1",type:u.dataPondId===r.value?"warning":"",bordered:!1},{default:t(()=>[h(" 名称 ")]),_:2},1032,["type"]),e(S,{style:{"max-width":"180px"}},{default:t(()=>[h(B(u.dataPondName||"暂无"),1)]),_:2},1024)]),f("div",null,[e(k,{class:"go-mr-1",type:u.dataPondId===r.value?"warning":"",bordered:!1},{default:t(()=>[h(" 地址 ")]),_:2},1032,["type"]),e(S,{style:{"max-width":"180px"}},{default:t(()=>[h(B(u.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),f("div",{class:"item-content-icon go-transition-quick",onClick:j=>p(j,u)},[e(g,null,{default:t(()=>[e(a(q))]),_:1})],8,Ve)]),f("div",{class:de({"select-modal":u.dataPondId===r.value})},null,2)],10,Me))),128))]),_:1})])])}}});const Ye=Q(Je,[["__scopeId","data-v-57909643"]]),We=f("thead",null,[f("tr",null,[f("th",null,"key"),f("th",null,"value")])],-1),ue=F({__name:"displayTable",props:{target:Object},setup(s){const d=s,i={key:"",value:""},q=qe({content:[]});return X(()=>d.target,x=>{q.content=[];for(const b in x)q.content.push({key:b,value:x[b]});q.content.length||(q.content=[JSON.parse(JSON.stringify(i))])},{immediate:!0,deep:!0}),(x,b)=>{const c=o("n-table");return _(),T(c,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:t(()=>[We,f("tbody",null,[(_(!0),C(V,null,ae(q.content,(v,r)=>(_(),C("tr",{key:r},[f("td",null,B(v.key||"暂无"),1),f("td",null,B(v.value||"暂无"),1)]))),128))])]),_:1})}}}),Xe={class:"go-chart-data-display"},Ke={class:"go-mr-3"},Ze={key:0},et={class:"go-mt-3"},tt={key:0},at={key:1},nt={key:1},ot=F({__name:"index",props:{globalData:Object,targetData:Object},setup(s){const d=s,{HelpOutlineIcon:i,FlashIcon:q,PulseIcon:x}=ee.ionicons5,{requestUrl:b,requestInterval:c,requestHttpType:v,requestContentType:r,requestSQLContent:y,requestParams:w,requestParamsBodyType:p,requestIntervalUnit:P}=Z(d.targetData.dataPondRequestConfig);L.HEADER;const D={[W.DEFAULT]:"普通请求",[W.SQL]:"SQL 请求"},I=$(L.PARAMS);return(O,E)=>{const g=o("n-input"),N=o("n-icon"),U=o("n-divider"),n=o("n-tab"),l=o("n-tabs"),m=o("n-text"),k=o("n-card"),S=o("n-code"),z=o("n-scrollbar");return _(),C("div",Xe,[e(z,{style:{"max-height":"570px"}},{default:t(()=>[f("div",Ke,[f("div",null,[e(a(H),{name:"主体信息"},{default:t(()=>[e(a(A),{name:"接口名称"},{default:t(()=>{var u;return[e(g,{size:"small",placeholder:((u=s.targetData)==null?void 0:u.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(a(A),{name:"接口类型"},{default:t(()=>[e(g,{size:"small",placeholder:a(v)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(a(H),null,{default:t(()=>[e(a(A),{name:"组件间隔"},{default:t(()=>[e(g,{size:"small",placeholder:`${a(c)||"暂无"}`,disabled:!0},{suffix:t(()=>[h(B(s.targetData&&a(re)[a(P)]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(A),{name:"全局间隔（默认）"},{default:t(()=>{var u;return[e(g,{size:"small",placeholder:`${((u=s.globalData)==null?void 0:u.requestInterval)||"暂无"}`,disabled:!0},{suffix:t(()=>[h(B(s.globalData&&a(re)[s.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(a(H),{name:"源地址",alone:!0},{default:t(()=>{var u;return[e(g,{size:"small",placeholder:((u=s.globalData)==null?void 0:u.requestOriginUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(N,{component:a(x)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(H),{name:"接口地址",alone:!0},{default:t(()=>[e(g,{size:"small",placeholder:a(b)||"暂无",disabled:!0},{prefix:t(()=>[e(N,{component:a(q)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(U),e(a(H),{name:"类型"},{default:t(()=>[e(a(A),{name:"配置类型"},{default:t(()=>[e(g,{size:"small",placeholder:s.targetData&&D[a(r)],disabled:!0},null,8,["placeholder"])]),_:1}),a(r)===a(W).DEFAULT?(_(),T(a(A),{key:0,name:"body 类型"},{default:t(()=>[e(g,{size:"small",placeholder:s.targetData&&a(p),disabled:!0},null,8,["placeholder"])]),_:1})):te("",!0)]),_:1}),a(r)===a(W).DEFAULT?(_(),C("div",Ze,[e(l,{type:"line",animated:"",value:I.value,"onUpdate:value":E[0]||(E[0]=u=>I.value=u)},{default:t(()=>[(_(!0),C(V,null,ae(a(L),u=>(_(),T(n,{key:u,name:u,tab:u},{default:t(()=>[h(B(u),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),f("div",et,[I.value!==a(L).BODY?(_(),C("div",tt,[e(ue,{class:"go-my-3",target:a(w)[I.value]},null,8,["target"])])):(_(),C("div",at,[a(p)===a(M).NONE?(_(),T(k,{key:0,class:"go-mt-3 go-pb-3"},{default:t(()=>[e(m,{depth:"3"},{default:t(()=>[h("该接口没有 Body 体")]),_:1})]),_:1})):a(p)===a(M).FORM_DATA||a(p)===a(M).X_WWW_FORM_URLENCODED?(_(),T(ue,{key:1,class:"go-my-3",target:a(w)[a(L).BODY][a(p)]},null,8,["target"])):a(p)===a(M).JSON?(_(),T(k,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:t(()=>[e(S,{code:a(w)[a(L).BODY][a(p)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):a(p)===a(M).XML?(_(),T(S,{key:3,code:a(w)[a(L).BODY][a(p)]||"",language:"html"},null,8,["code"])):te("",!0)]))])])):(_(),C("div",nt,[e(a(H),{name:"键名"},{default:t(()=>[e(m,null,{default:t(()=>[h("sql")]),_:1})]),_:1}),e(a(H),{name:"键值"},{default:t(()=>[e(S,{code:a(y).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const st=Q(ot,[["__scopeId","data-v-a7a3ca3e"]]),lt={class:"pond-content"},dt={key:1,class:"no-data go-flex-center"},rt=["src"],ct=F({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(s,{emit:d}){const i=s,{PencilIcon:q}=ee.ionicons5,{chartEditStore:x,targetData:b}=ne(),{requestDataPond:c}=Z(x.getRequestGlobalConfig),v=$(!1),r=$(!1),y=$(!1),w=$(!1),p=$(),P=G(()=>{var m,k;const n=(k=(m=b==null?void 0:b.value)==null?void 0:m.request)==null?void 0:k.requestDataPondId;return n?c.value.filter(S=>n===S.dataPondId)[0]:void 0});X(()=>i.modelShow,n=>{r.value=n}),X(()=>P.value,n=>{y.value=!0,p.value=n,xe(()=>{y.value=!1})},{immediate:!0});const D=(n=!1)=>{w.value=!!n,v.value=!0},I=()=>{const n=we();p.value={dataPondId:n,dataPondName:n,dataPondRequestConfig:Ee.cloneDeep(Y(J({},ke),{requestDataType:ce.Pond}))},D()},O=n=>{w.value?E(n):g(n),w.value=!1,v.value=!1},E=n=>{try{const l=c.value.findIndex(m=>m.dataPondId===n.dataPondId);l!==-1?(c.value.splice(l,1,n),x.getComponentList.forEach(m=>{m.request.requestDataType===ce.Pond&&m.request.requestDataPondId===n.dataPondId&&(m.request=Y(J({},K(n.dataPondRequestConfig)),{requestDataPondId:n.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(l){window.$message.error("编辑失败，请稍后重试！")}},g=n=>{try{p.value?(c.value.unshift(n),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(l){window.$message.error("创建失败，请稍后重试!")}},N=n=>{pe({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const l=c.value.findIndex(m=>m.dataPondId===n.dataPondId);l!==-1?(c.value.splice(l,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},U=()=>{P.value&&(b.value.request=Y(J({},K(P.value.dataPondRequestConfig)),{requestDataPondId:P.value.dataPondId})),d("update:modelShow",!1),d("sendHandle")};return(n,l)=>{const m=o("n-text"),k=o("n-icon"),S=o("n-button"),z=o("n-space"),u=o("n-card"),j=o("n-modal");return _(),C(V,null,[e(j,{class:"go-chart-data-pond-control",show:r.value,"onUpdate:show":l[1]||(l[1]=R=>r.value=R),"mask-closable":!1},{default:t(()=>[e(u,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(z,{justify:"space-between"},{default:t(()=>[e(S,{type:"info",secondary:"",disabled:!P.value,onClick:l[0]||(l[0]=R=>D(!0))},{icon:t(()=>[e(k,null,{default:t(()=>[e(a(q))]),_:1})]),default:t(()=>[h(" 编辑内容 ")]),_:1},8,["disabled"]),e(S,{type:"primary",onClick:U},{default:t(()=>[h("保存 & 发送请求")]),_:1})]),_:1})]),default:t(()=>[f("div",lt,[P.value&&!y.value?(_(),T(a(st),{key:0,targetData:P.value,globalData:a(x).getRequestGlobalConfig},null,8,["targetData","globalData"])):(_(),C("div",dt,[f("img",{src:a(Re),alt:"暂无数据"},null,8,rt),e(m,{depth:3},{default:t(()=>[h("暂未选择公共接口")]),_:1})])),e(a(Ye),{onCreatePond:I,onDeletePond:N})])]),_:1})]),_:1},8,["show"]),e(a(Le),{modelShow:v.value,"onUpdate:modelShow":l[2]||(l[2]=R=>v.value=R),targetDataRequest:p.value,isEdit:w.value,onEditSaveHandle:O},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const ut=Q(ct,[["__scopeId","data-v-03dd35bb"]]),it={class:"go-chart-data-pond"},_t={class:"go-absolute-center"},pt=F({__name:"index",setup(s){ie(n=>({a2c2e7aa:g.value}));const d=_e(),{HelpOutlineIcon:i,FlashIcon:q,PulseIcon:x,FishIcon:b}=ee.ionicons5,{targetData:c,chartEditStore:v}=ne(),{requestDataPond:r,requestInterval:y,requestIntervalUnit:w}=Z(v.getRequestGlobalConfig),p=$(!1),P=$(!1),D=$(!1);let I=0,O;const E=G(()=>{const n=c.value.request.requestDataPondId;return n?r.value.filter(m=>n===m.dataPondId)[0]:void 0}),g=G(()=>d.getAppTheme),N=()=>{P.value=!0},U=()=>le(this,null,function*(){var n;if(!((n=c.value)!=null&&n.request)){window.$message.warning("请选择一个公共接口！");return}p.value=!0;try{c.value.request.requestSQLContent.action="ListData",c.value.request.requestSQLContent.id=c.value.id,c.value.request.requestSQLContent.projectId=Ie();const l=yield Ce(K(c.value.request),K(v.getRequestGlobalConfig));if(p.value=!1,l){if(!(l!=null&&l.data)&&!c.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),D.value=!0;return}c.value.option.dataset=Se(l==null?void 0:l.data,l,c.value.filter),D.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(l){console.error(l),p.value=!1,window.$message.warning("数据异常，请检查参数！")}});return Pe(()=>{var l;const n=(l=c.value)==null?void 0:l.filter;O!==n&&I&&(O=n,U()),I++}),De(()=>{O=null}),(n,l)=>{const m=o("n-icon"),k=o("n-input"),S=o("n-button"),z=o("n-card"),u=o("n-tooltip"),j=o("go-skeleton");return _(),C(V,null,[f("div",it,[e(z,{class:"n-card-shallow"},{default:t(()=>[e(a(H),{name:"请求名称",alone:!0},{default:t(()=>{var R;return[e(k,{size:"small",placeholder:((R=E.value)==null?void 0:R.dataPondName)||"暂无",disabled:!0},{prefix:t(()=>[e(m,{component:a(b)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(H),{name:"接口地址",alone:!0},{default:t(()=>{var R;return[e(k,{size:"small",placeholder:((R=E.value)==null?void 0:R.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(m,{component:a(q)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),f("div",{class:"edit-text",onClick:N},[f("div",_t,[e(S,{type:"primary",secondary:""},{default:t(()=>[h("编辑配置")]),_:1})])])]),_:1})]),e(a(H),{alone:!0},{name:t(()=>[h(" 测试 "),e(u,{trigger:"hover"},{trigger:t(()=>[e(m,{size:"21",depth:3},{default:t(()=>[e(a(i))]),_:1})]),default:t(()=>[h(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e(S,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[e(m,null,{default:t(()=>[e(a(q))]),_:1})]),default:t(()=>[h(" 发送请求 ")]),_:1})]),_:1}),e(a(He),{show:D.value&&!p.value,ajax:!0},null,8,["show"]),e(j,{load:p.value,repeat:3},null,8,["load"]),e(a(ut),{modelShow:P.value,"onUpdate:modelShow":l[0]||(l[0]=R=>P.value=R),onSendHandle:U},null,8,["modelShow"])],64)}}});const Nt=Q(pt,[["__scopeId","data-v-f1a26830"]]);export{Nt as default};

var ne=Object.defineProperty,re=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var L=(t,e,o)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,a=(t,e)=>{for(var o in e||(e={}))ae.call(e,o)&&L(t,o,e[o]);if(T)for(var o of T(e))ie.call(e,o)&&L(t,o,e[o]);return t},R=(t,e)=>re(t,se(e));var w=(t,e,o)=>new Promise((n,c)=>{var i=r=>{try{p(o.next(r))}catch(u){c(u)}},d=r=>{try{p(o.throw(r))}catch(u){c(u)}},p=r=>r.done?n(r.value):Promise.resolve(r.value).then(i,d);p((o=o.apply(t,e)).next())});import{g as G}from"./storage-17c416b1.js";import"./querySelectorAll-a1c431d2.js";import{ax as ce,d as f,o as l,c as y,q as N,aw as I,u as s,ay as F,av as C,az as D,aA as H,aB as X,D as v,aC as Y,aD as V,E as j,F as z,h as M,a1 as S,aE as le,m as ue,j as J,aF as de,aG as pe,aH as A,n as ye,b as E,a6 as K,w as me,aI as ve,aJ as B,aK as fe,al as he}from"./index-3efa3bcd.js";import{u as ge,f as _e,a as we}from"./index-a77faccb.js";import{u as Q}from"./useLifeHandler.hook-22986a79.js";import{u as x,C as Ce}from"./chartEditStore-1e6a587f.js";import{l as O}from"./listen-92ff7612.js";import"./project.api-31a95c84.js";import"./SettingItem-aacbe70b.js";/* empty css                                                                      */import"./SettingItemBox-94318b9b.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-bd202dab.js";import"./icon-f6cbc454.js";import"./index.esm.min-21e18cb2.js";import"./plugin-52ae8d1b.js";import"./fileTypeEnum-21359a08.js";const U=(t,e)=>({zIndex:e+1,left:`${t.x}px`,top:`${t.y}px`}),W=(t,e)=>({width:`${e?e*t.w:t.w}px`,height:`${e?e*t.h:t.h}px`}),Z=t=>({display:t.hide?"none":"block"}),ee=t=>{const e={};return t&&t.overFlowHidden&&(e.overflow="hidden"),e},Se=t=>{const e=t.selectColor?{background:t.background}:{background:`url(${t.backgroundImage}) center center / cover no-repeat !important`};return a({position:"relative",width:t.width?`${t.width||100}px`:"100%",height:t.height?`${t.height}px`:"100%"},e)},xe=()=>{window.$KeyboardActive={ctrl:!1,space:!1},document.onkeydown=t=>{const{keyCode:e}=t;if(e==32&&t.target==document.body&&t.preventDefault(),[17,32].includes(e)&&window.$KeyboardActive)switch(e){case 17:window.$KeyboardActive.ctrl=!0;break;case 32:window.$KeyboardActive.space=!0;const o=document.querySelector(".go-preview");o&&o.style.position==="absolute"&&(o.style.cursor="move");break}},document.onkeyup=t=>{const{keyCode:e}=t;if(e==32&&t.target==document.body&&t.preventDefault(),[17,32].includes(e)&&window.$KeyboardActive)switch(e){case 17:window.$KeyboardActive.ctrl=!1;break;case 32:window.$KeyboardActive.space=!1;break}const o=document.querySelector(".go-preview");o&&(o.style.cursor="default")}};let k=[0,0],$=[0,0];const P=t=>{var d,p;const e=document.querySelector(".go-preview");if(!e||e.style.position!=="absolute"||!((d=window.$KeyboardActive)!=null&&d.space))return;t.preventDefault(),t.stopPropagation(),(p=document.activeElement)==null||p.blur();const o=t.screenX,n=t.screenY,c=O(window,"mousemove",ce(r=>{const u=r.screenX-o,h=r.screenY-n,[m,g]=k,[b,_]=$;if(k=[g,u],$=[_,h],e){const te=e.style.left?Number(e.style.left.split("px")[0]):0,oe=e.style.top?Number(e.style.top.split("px")[0]):0;e.style.left=te+(g>m?Math.abs(g-m):-Math.abs(g-m))+"px",e.style.top=oe+(_>b?Math.abs(_-b):-Math.abs(_-b))+"px"}},20)),i=O(window,"mouseup",()=>{k=[0,0],$=[0,0],c(),i()})},be=f({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(t){return(e,o)=>(l(!0),y(z,null,N(t.groupData.groupList,n=>(l(),y("div",{class:I(["chart-item",s(F)(n.styles.animations)]),key:n.id,style:C(a(a(a(a(a(a({},s(U)(n.attr,t.groupIndex)),s(D)(n.styles)),s(H)(n.styles)),s(Z)(n.status)),s(ee)(n.preview)),s(X)(n.styles)))},[(l(),v(j(n.chartConfig.chartKey),Y({id:n.id,chartConfig:n,themeSetting:t.themeSetting,themeColor:t.themeColor,style:a({},s(W)(n.attr))},V(s(Q)(n))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});const ke=M(be,[["__scopeId","data-v-54de5a01"]]),$e=f({__name:"index",setup(t){const{initDataPond:e,clearMittDataPondMap:o}=ge(),n=x(),c=S(()=>n.editCanvasConfig.chartThemeSetting),i=S(()=>le(n.editCanvasConfig.chartCustomThemeColorInfo)[n.editCanvasConfig.chartThemeColor]);return o(),ue(()=>{e(x)}),(d,p)=>(l(!0),y(z,null,N(s(n).componentList,(r,u)=>(l(),y("div",{class:I(["chart-item",s(F)(r.styles.animations)]),key:r.id,style:C(a(a(a(a(a(a({},s(U)(r.attr,u)),s(D)(r.styles)),s(H)(r.styles)),s(Z)(r.status)),s(ee)(r.preview)),s(X)(r.styles)))},[r.isGroup?(l(),v(s(ke),{key:0,groupData:r,groupIndex:u,themeSetting:c.value,themeColor:i.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(l(),v(j(r.chartConfig.chartKey),Y({key:1,id:r.id,chartConfig:r,themeSetting:c.value,themeColor:i.value,style:a({},s(W)(r.attr))},V(s(Q)(r))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});const q=M($e,[["__scopeId","data-v-fb03145e"]]),Ee=t=>{const e=J(!1),o=setInterval(()=>{var n;if((n=window.$vue)!=null&&n.component){clearInterval(o);const c=i=>{window.$vue.component(i.chartConfig.chartKey)||window.$vue.component(i.chartConfig.chartKey,_e(i.chartConfig))};t.componentList.forEach(i=>w(void 0,null,function*(){i.isGroup?i.groupList.forEach(d=>{c(d)}):c(i)})),e.value=!0}},200);return{show:e}},Ie=t=>{const e=x();e.requestGlobalConfig=t[Ce.REQUEST_GLOBAL_CONFIG]},De=f({__name:"suspenseIndex",setup(t){return w(this,null,function*(){let e,o;[e,o]=de(()=>G()),yield e,o();const n=x();pe(`预览-${n.editCanvasConfig.projectName}`);const c=S(()=>a(a({},Se(n.editCanvasConfig)),D(n.editCanvasConfig))),i=S(()=>{const u=n.editCanvasConfig.previewScaleType;return u===A.SCROLL_Y||u===A.SCROLL_X});Ie(n);const{entityRef:d,previewRef:p}=we(n),{show:r}=Ee(n);return xe(),(u,h)=>(l(),y("div",{class:I(`go-preview ${s(n).editCanvasConfig.previewScaleType}`),onMousedown:h[0]||(h[0]=(...m)=>s(P)&&s(P)(...m))},[i.value?(l(),y("div",{key:0,ref_key:"entityRef",ref:d,class:"go-preview-entity"},[ye("div",{ref_key:"previewRef",ref:p,class:"go-preview-scale"},[s(r)?(l(),y("div",{key:0,style:C(c.value)},[E(s(q))],4)):K("",!0)],512)],512)):(l(),y("div",{key:1,ref_key:"previewRef",ref:p,class:"go-preview-scale"},[s(r)?(l(),y("div",{key:0,style:C(c.value)},[E(s(q))],4)):K("",!0)],512))],34))})}});const Me=M(De,[["__scopeId","data-v-e8e5e427"]]),Te=f({__name:"index",setup(t){return(e,o)=>(l(),v(ve,null,{default:me(()=>[E(Me)]),_:1}))}}),Je=f({__name:"wrapper",setup(t){let e=J(Date.now());return[B.JSON,B.CHART_TO_PREVIEW].forEach(o=>{window.opener&&window.opener.addEventListener(o,n=>w(this,null,function*(){const c=yield G();fe(he.GO_CHART_STORAGE_LIST,[R(a({},n.detail),{id:c.id})]),e.value=Date.now()}))}),(o,n)=>(l(),v(Te,{key:s(e)}))}});export{Je as default};

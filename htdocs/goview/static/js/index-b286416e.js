var z=(q,p,r)=>new Promise((b,o)=>{var g=u=>{try{c(r.next(u))}catch(m){o(m)}},w=u=>{try{c(r.throw(u))}catch(m){o(m)}},c=u=>u.done?b(u.value):Promise.resolve(u.value).then(g,w);c((r=r.apply(q,p)).next())});import{d as O,$ as L,j as k,aS as B,J as P,r as n,o as F,D as J,w as t,b as e,n as I,e as l,t as f,u as a,h as N,bg as K,O as W,a1 as X,ba as Y,cC as Z,c as ee,d3 as $,aN as te,bt as ae,ac as E,bu as oe}from"./index-3efa3bcd.js";import{i as ne}from"./icon-f6cbc454.js";import{S as H}from"./SettingItem-aacbe70b.js";import{S as U}from"./SettingItemBox-94318b9b.js";import"./chartEditStore-1e6a587f.js";/* empty css                                                                      */import{u as Q}from"./useTargetData.hook-4df2987a.js";import{R as se,a as le}from"./pondIndex.vue_vue_type_style_index_0_scoped_639b4b2b_lang-1dd3716c.js";import{u as re}from"./useSync.hook-e4169a36.js";import"./index-9ba8d76c.js";import"./EditorWorker-1ca10225.js";import"./editorWorker-02e2e6ec.js";import"./chartLayoutStore-db3d2e1b.js";import"./index-a77faccb.js";import{C as ue}from"./index-b6a655f0.js";import"./plugin-52ae8d1b.js";import"./project.api-31a95c84.js";import"./index-243612e8.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-bd202dab.js";import"./index.esm.min-21e18cb2.js";import"./fileTypeEnum-21359a08.js";const ce={class:"go-pr-3"},de=O({__name:"index",props:{modelShow:Boolean,targetData:Object,saveBtnText:String||null},emits:["update:modelShow","sendHandle"],setup(q,{emit:p}){const r=q,{targetData:b}=Q(),{dataSyncUpdate:o}=re(),{chartConfig:g}=L(r.targetData),{requestContentType:w}=L(r.targetData.request),c=k(!1),u={[B.DEFAULT]:"普通请求",[B.SQL]:"SQL 请求"};P(()=>r.modelShow,h=>{c.value=h},{immediate:!0});const m=()=>{p("update:modelShow",!1)},_=()=>{p("update:modelShow",!1),p("sendHandle"),o()};return(h,v)=>{const S=n("n-space"),x=n("n-scrollbar"),y=n("n-text"),C=n("n-tag"),T=n("n-button"),d=n("n-card"),s=n("n-modal");return F(),J(s,{class:"go-chart-data-request",show:c.value,"onUpdate:show":v[0]||(v[0]=i=>c.value=i),"mask-closable":!1,closeOnEsc:!1},{default:t(()=>[e(d,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(S,{justify:"space-between"},{default:t(()=>[I("div",null,[e(y,null,{default:t(()=>[l("「 "+f(a(g).categoryName)+" 」",1)]),_:1}),e(y,null,{default:t(()=>[l("—— ")]),_:1}),e(C,{type:"primary",bordered:!1,style:{"border-radius":"5px"}},{default:t(()=>[l(f(u[a(w)]),1)]),_:1})]),I("div",null,[e(T,{type:"primary",onClick:m},{default:t(()=>[l(f("关闭"))]),_:1}),e(y,null,{default:t(()=>[l("　")]),_:1}),e(T,{type:"primary",onClick:_},{default:t(()=>[l(f(q.saveBtnText||"保存 & 发送请求"),1)]),_:1})])]),_:1})]),default:t(()=>[e(x,{style:{"max-height":"718px"}},{default:t(()=>[I("div",ce,[e(S,{vertical:""},{default:t(()=>{var i;return[e(a(se)),e(a(le),{"target-data-request":(i=a(b))==null?void 0:i.request},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ie=N(de,[["__scopeId","data-v-6e39833e"]]),pe={class:"go-chart-configurations-data-ajax"},me={class:"go-absolute-center"},_e=O({__name:"index",setup(q){K(d=>({"3fb3ef67":T.value}));const{HelpOutlineIcon:p,FlashIcon:r,PulseIcon:b}=ne.ionicons5,{targetData:o,chartEditStore:g}=Q(),{requestOriginUrl:w,requestInterval:c,requestIntervalUnit:u}=L(g.getRequestGlobalConfig),m=W(),_=k(!1),h=k(!1),v=k(!1);let S=0,x;const y=()=>{h.value=!0},C=()=>z(this,null,function*(){var d;if((d=o.value)!=null&&d.request){_.value=!0;try{o.value.request.requestSQLContent.id=o.value.id,o.value.request.requestSQLContent.action="ListData",o.value.request.requestSQLContent.projectId=te();const s=yield ae(E(o.value.request),E(g.getRequestGlobalConfig));if(_.value=!1,s){const{data:i}=s;if(!i&&!o.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),v.value=!0;return}o.value.option.dataset=oe(i,s,o.value.filter),v.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(s){console.error(s),_.value=!1,window.$message.warning("数据异常，请检查参数！")}}}),T=X(()=>m.getAppTheme);return Y(()=>{var s;const d=(s=o.value)==null?void 0:s.filter;x!==d&&S&&(x=d,C()),S++}),Z(()=>{x=null}),(d,s)=>{const i=n("n-tag"),D=n("n-input"),R=n("n-icon"),j=n("n-button"),A=n("n-card"),G=n("n-tooltip"),V=n("go-skeleton");return F(),ee("div",pe,[e(A,{class:"n-card-shallow"},{default:t(()=>[e(a(U),{name:"请求配置"},{default:t(()=>[e(a(H),{name:"类型"},{default:t(()=>[e(i,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{default:t(()=>[l(f(a(o).request.requestContentType===a(B).DEFAULT?"普通请求":"SQL请求"),1)]),_:1})]),_:1}),e(a(H),{name:"方式"},{default:t(()=>[e(D,{size:"small",placeholder:a(o).request.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(a(H),{name:"组件间隔"},{default:t(()=>[e(D,{size:"small",placeholder:`${a(o).request.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[l(f(a($)[a(o).request.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(H),{name:"全局间隔（默认）"},{default:t(()=>[e(D,{size:"small",placeholder:`${a(c)||"暂无"} `,disabled:!0},{suffix:t(()=>[l(f(a($)[a(u)]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(a(U),{name:"源地址",alone:!0},{default:t(()=>[e(D,{size:"small",placeholder:a(w)||"暂无",disabled:!0},{prefix:t(()=>[e(R,{component:a(b)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(U),{name:"组件地址",alone:!0},{default:t(()=>[e(D,{size:"small",placeholder:a(o).request.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e(R,{component:a(r)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),I("div",{class:"edit-text",onClick:y},[I("div",me,[e(j,{type:"primary",secondary:""},{default:t(()=>[l("编辑配置")]),_:1})])])]),_:1}),e(a(U),{alone:!0},{name:t(()=>[l(" 测试 "),e(G,{trigger:"hover"},{trigger:t(()=>[e(R,{size:"21",depth:3},{default:t(()=>[e(a(p))]),_:1})]),default:t(()=>[l(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e(j,{type:"primary",ghost:"",onClick:C},{icon:t(()=>[e(R,null,{default:t(()=>[e(a(r))]),_:1})]),default:t(()=>[l(" 发送请求 ")]),_:1})]),_:1}),e(a(ue),{show:v.value&&!_.value,ajax:!0},null,8,["show"]),e(V,{load:_.value,repeat:3},null,8,["load"]),e(a(ie),{modelShow:h.value,"onUpdate:modelShow":s[0]||(s[0]=M=>h.value=M),targetData:a(o),onSendHandle:C},null,8,["modelShow","targetData"])])}}});const $e=N(_e,[["__scopeId","data-v-cbb21a91"]]);export{$e as default};
